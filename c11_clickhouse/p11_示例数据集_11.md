# 纽约公共图书馆“菜单上有什么？”数据集

- docs: <https://clickhouse.com/docs/zh/getting-started/example-datasets/menus>

### 下载数据集、解压数据集、导入数据

```shell
# 下载数据：
wget https://s3.amazonaws.com/menusdata.nypl.org/gzips/2021_08_01_07_01_17_data.tgz

# 解压数据：
tar xvf 2021_08_01_07_01_17_data.tgz

```

创建表：

```sql
-- Dish - 有关菜肴的信息，其中包含：菜肴名称以及一些特征。
CREATE TABLE dish
(
    id             UInt32,
    name           String,
    description    String,
    menus_appeared UInt32,
    times_appeared Int32,
    first_appeared UInt16,
    last_appeared  UInt16,
    lowest_price   Decimal64(3),
    highest_price  Decimal64(3)
) ENGINE = MergeTree ORDER BY id;

-- Menu - 有关菜单的信息，其中包含：餐厅名称，看到菜单的日期等
CREATE TABLE menu
(
    id                   UInt32,
    name                 String,
    sponsor              String,
    event                String,
    venue                String,
    place                String,
    physical_description String,
    occasion             String,
    notes                String,
    call_number          String,
    keywords             String,
    language             String,
    date                 String,
    location             String,
    location_type        String,
    currency             String,
    currency_symbol      String,
    status               String,
    page_count           UInt16,
    dish_count           UInt16
) ENGINE = MergeTree ORDER BY id;

-- MenuPage - 有关菜单中页面的信息，每个页面都属于某个 Menu。
CREATE TABLE menu_page
(
    id          UInt32,
    menu_id     UInt32,
    page_number UInt16,
    image_id    String,
    full_height UInt16,
    full_width  UInt16,
    uuid        UUID
) ENGINE = MergeTree ORDER BY id;

-- MenuItem - 菜单项。某个菜单页面上的菜肴及其价格：指向 Dish 和 MenuPage的链接。
CREATE TABLE menu_item
(
    id           UInt32,
    menu_page_id UInt32,
    price        Decimal64(3),
    high_price   Decimal64(3),
    dish_id      UInt32,
    created_at   DateTime,
    updated_at   DateTime,
    xpos         Float64,
    ypos         Float64
) ENGINE = MergeTree ORDER BY id;

```

导入数据：
```shell
clickhouse-client --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --query "INSERT INTO dish FORMAT CSVWithNames" < Dish.csv
clickhouse-client --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --query "INSERT INTO menu FORMAT CSVWithNames" < Menu.csv
clickhouse-client --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --query "INSERT INTO menu_page FORMAT CSVWithNames" < MenuPage.csv
clickhouse-client --format_csv_allow_single_quotes 0 --input_format_null_as_default 0 --date_time_input_format best_effort --query "INSERT INTO menu_item FORMAT CSVWithNames" < MenuItem.csv
```